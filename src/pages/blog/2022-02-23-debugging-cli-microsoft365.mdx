---
templateKey: blog-post
title: Setting debugging of CLI for Microsoft 365
date: 2022-02-23T08:09:46.501Z
description: You'll learn how to configure debugging sessions in CLI for Microsoft 365.
featuredpost: false
tags:
  - cli-microsoft365
  - vs code
  - javascript
  - typescript
---
## Prerequisites

To go through the article we need to have our development environment. There are two main ways to create the environment: locally and using Remote Development Containers.

If you want to use your local environment, follow the article [Minimal Path to Awesome](https://github.com/pnp/cli-microsoft365/wiki/Minimal-Path-to-Awesome). For Remote Development Containers, follow [GitHub Codespaces & Visual Studio Remote Development Container](https://github.com/pnp/cli-microsoft365/wiki/GitHub-Codespaces-&-Visual-Studio-Remote-Development-Container).

In this article, we'll be using the environment based on GitHub Codespaces.

## Building the project

Each time we make the changes, we need to rebuild the project.

We do it by running the following command:

```shell
npm run build
```

## Debugging CLI

For CLI debugging we'll need to define the arguments. The debugger will run that *m365* command in debug mode.

We can then set our breakpoints to pause the execution. Once paused, we'll be able to inspect the current context. We could also run the program step by step.

### Opening launch file

To configure the arguments passed in debug mode, we'll edit *.vscode/launch.json*. We can open it directly from the file explorer:

![Opening launch.json from file explorer](../../img/20220305-134709-l2ieqme1dp.png)

We can also open it from the *Run and Debug* bar (1). We need to click a little gear icon (2) next to the *Debug CLI* dropdown:

![Opening launch.json from run and debug bar](../../img/20220305-135036-crgmpipcuo.png)

### Setting the arguments

The arguments need to be entered under the *configurations* array (1). We'll edit the one with the name *Debug CLI* (2). Our arguments need to go to the *args* array (3):

![Finding proper section in launch file](../../img/20220305-140016-k24hedaxzs.png)

The comments above the *args* array explain how to use it.

In my example, I troubleshoot usage of the incorrect value for `--output`. I'd like to debug what's happening when I run:

```shell
m365 version --output asdasd
```

Translated to the array, it'll look like:

```json
"args": ["version", "--output", "asdasd"]
```

Let's save the file and run the debug mode.

### Running the debug mode

To run debug mode we can simply hit the F5 button. We can also run it by opening the *Run and Debug* tab (1) and clicking the play button (2):

![Running the debug mode from the Run and Debug tab](../../img/20220311-152558-wi1ysis2rv.png)

How to confirm we entered the debug mode? We can notice a few differences:

* The little bar with debug controls will appear
* The panel tab will switch to the *Debug Console*
* The bottom bar will be orange

The differences are outlined in the screenshot below:

![Debug mode differences](../../img/20220311-152847-ebairro7ui.png)

## Debugging tests

We now know how to debug command execution.

But what about the tests? Tests are an important part of CLI for Microsoft 365. Current (and desired) test coverage is 100%. It means that for many of the changes we might need to troubleshoot the tests, too.

There are several options for running the tests. As described on [Adding a command](https://github.com/pnp/cli-microsoft365/wiki/Adding-a-command#implement-unit-tests) wiki page:

> To run just your tests, either add `.only` to your test suite (eg. `describe.only(commands.MY_COMMAND)`) or update the glob in the `.mocharc.json` file, `spec` property to match the path to your test files, like `dist/m365/aad/commands/approleassignment/**/*.spec.js`.

Below we're exploring all these options.

### Adding .only to the test suite

The first option is to add `.only` to the test suite. We need to open a test file something.spec.ts. Inside, we replace `describe` with `describe.only:`

![Replacing describe with describe.only](../../img/20220425-160042-7kal6y0w7f.png)

If we want to run only one test, we can add `.only` after the `it` statement:

![Replacing it with it.only](../../img/20220425-160343-l2xbyf14kj.png)

In any case, we need to compile the code using `npm run build`. When the build task is finished, we can run the debug mode.

Steps to run the debug mode are described under [Running the debug mode for tests](#running-the-debug-mode-for-tests). Before going there, let's explore other options for limiting the number of tests.

### Updating .mocharc.json

All the settings for Mocha (test framework used in the project) are stored in the `.mocharc.json` file. The file is in the root folder of the repository.

The file contains the argument *spec*. It is responsible for specifying the files to be included in the test suite. If we want to run tests from only one file, we need to supply its path to the *spec* argument.

We also need to remember that the path should lead to the compiled file. We'll simply change the *src* folder to the *dist* folder and the extension from *ts* to *js*.

See the code block below for the example:

```powershell
 src/appInsights.spec.ts
dist/appInsights.spec.js
^                     ^
folder name           extension
```

### Overwriting the launch file config

The *launch.json* file we edited for CLI debugging contains another configuration object named *Debug Tests*. The object has no arguments (property `args`). It uses the default configuration, pulled from *.mocharc.json* file.

However, we can add the arguments ourselves. We also need to tell Mocha to ignore the config file.

The example *args* array we can set would be:



TO BE CONTINUED

By default the first argument is:

```json
 "dist/**/*.spec.js"
```

It means all tests from the files ending with `.spec.js` will run. But we don't want to run all the tests. We only want to run tests from the specific file we edited.

In our example, we edited tests in *src/m365/aad/commands/app/app-add.spec.ts*. We need to locate the respective JavaScript file in the *dist* folder. We need to change two things:

```powershell
 src/m365/aad/commands/app/app-add.spec.ts
dist/m365/aad/commands/app/app-add.spec.js
^                                       ^
folder name                     extension
```

If we locate the compiled file in the folder tree, we can right-click it (1) and copy its relative path (2). The path needs to replace the first element in the *args* array (3):

### Debugging via Test Explorer

### Running the debug mode for tests

After we save the *launch.json* file we can now run *Debug Tests* configuration. We need to go to *Run and Debug* tab (1) choose the configuration from the dropdown (2) and then hit the play button (3): 

![Running Debug Tests configuration](../../img/20220330-101433-keqcuyasqx.png)

The debug console will now indicate that only tests from a single file run. We can see it from the number of tests and the execution time:

![Number of tests and execution time for a single file](../../img/20220330-101836-8yzo0cmsw7.png)

If all tests run, the number will be bigger than 9.000 and the execution time will usually be more than 10 seconds:

![Number of tests and execution time for all tests](../../img/20220330-102905-wvbkj9ddmx.png)

## Cleaning up

## Basic actions in the debug mode

To learn more about what you can do in the debug mode you can read the [Debugging in Visual Studio Code](https://code.visualstudio.com/docs/editor/debugging) article.

In the linked article you'll learn how to:

* Control the debug flow with [debug actions](https://code.visualstudio.com/docs/editor/debugging#_debug-actions)
* Set [breakpoints](https://code.visualstudio.com/docs/editor/debugging#_breakpoints) or [logpoints](https://code.visualstudio.com/docs/editor/debugging#_logpoints)
* [Inspect data](https://code.visualstudio.com/docs/editor/debugging#_data-inspection) during the execution

## Conclusion